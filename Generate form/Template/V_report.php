<!DOCTYPE html>
<html lang="en">
<head>
<title>Report</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="#">
    <meta name="keywords"
    content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">
    <!-- Favicon icon -->
    <link rel="icon" type="image/x-icon" href="<?php echo base_url() ?>files/assets/images/Logo Denso DMIA.png">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="<?php echo base_url() ?>assets/plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/icon/feather/css/feather.css">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/icon/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/icon/icofont/css/icofont.css">  
    
    <!-- Select 2 css -->
    <link rel="stylesheet" href="<?php echo base_url() ?>files/bower_components/select2/dist/css/select2.min.css" />
    <link rel="stylesheet" href="<?php echo base_url() ?>files/bower_components/select2/dist/css/select.css" />
     <!-- sweet alert framework -->
     <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/bower_components/sweetalert2/dist/sweetalert2.css">
     <!--jpro-->
     <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/pages/j-pro/css/j-pro-modern.css">
    <!-- Data Table Css -->
    <link rel="stylesheet" type="text/css"
        href="<?php echo base_url() ?>files/bower_components/datatables.net-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/pages/data-table/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css"
        href="<?php echo base_url() ?>files/bower_components/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css"
        href="<?php echo base_url() ?>files/assets/pages/data-table/extensions/responsive/css/responsive.dataTables.css">
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/css/style.css">
    <!--direct chat-->
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/css/style2.css">
    <link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>files/assets/css/jquery.mCustomScrollbar.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" /> -->
    

    <script src="<?php echo base_url() ?>assets/plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
    
    
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/popper.js/dist/umd/popper.min.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/jquery-slimscroll/jquery.slimscroll.js"></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/modernizr/modernizr.js"></script>
     <!-- validator-->
     <script src="<?php echo base_url() ?>files/bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/jquery-validation/dist/additional-methods.min.js"></script>
     <!-- Select 2 js -->
     <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/select2/dist/js/select2.full.min.js"></script>
    <!-- Chart js -->
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/chart.js/dist/Chart.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/chart.js/dist/chart2.js"></script>
     <!-- data-table js -->
     <script src="<?php echo base_url() ?>files/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/data-table/js/jszip.min.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/data-table/js/pdfmake.min.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/data-table/js/vfs_fonts.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/data-table/extensions/responsive/js/dataTables.responsive.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/data-table/js/dataTables.bootstrap4.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="<?php echo base_url() ?>files/bower_components/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="<?php echo base_url() ?>assets/plugins/daterangepicker/daterangepicker.js"></script>
     <!-- sweet alert js -->
     <script type="text/javascript" src="<?php echo base_url() ?>files/bower_components/sweetalert2/dist/sweetalert2.min.js"></script>
     <!--jpro-->
     <script type="text/javascript" src="<?php echo base_url() ?>files/assets/pages/j-pro/js/jquery.ui.min.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/assets/pages/j-pro/js/jquery.maskedinput.min.js"></script>
     <script type="text/javascript" src="<?php echo base_url() ?>files/assets/pages/j-pro/js/jquery.j-pro.js"></script>
    <script src="<?php echo base_url() ?>files/assets/js/vartical-layout.min.js"></script>
    <!-- amchart js -->
<script src="<?php echo base_url() ?>files/assets/pages/widget/amchart/amcharts.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/widget/amchart/serial.js"></script>
    <script src="<?php echo base_url() ?>files/assets/pages/widget/amchart/light.js"></script>
    <script src="<?php echo base_url() ?>files/assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="<?php echo base_url() ?>files/assets/js/SmoothScroll.js"></script>
    <script src="<?php echo base_url() ?>files/assets/js/pcoded.min.js"></script>

    <script>
    // function success_alert() {
    //     Swal.fire({
    //         icon: "success",
    //         title: "Berhasil Approve",
    //         showConfirmButton: true,
    //        timer:2000
    //     }).then((result) => {
    //         // Setelah alert selesai, reload halaman
    //         if (result.dismiss === Swal.DismissReason.timer || result.isConfirmed) {
    //             location.reload();
    //         }
    //     });
    // }
    </script>

    <script>
    function success_alert() {
        Swal.fire({
            icon: "success",
            title: "Berhasil Approve",
            showConfirmButton: true
        }).then((result) => {
            // Reload halaman hanya jika tombol confirm diklik
            if (result.isConfirmed) {
                location.reload();
            }
        });
    }
    function success_alert_reject() {
        Swal.fire({
            icon: "success",
            title: "Berhasil Reject",
            showConfirmButton: true
        }).then((result) => {
            // Reload halaman hanya jika tombol confirm diklik
            if (result.isConfirmed) {
                location.reload();
            }
        });
    }
</script>

</script>

  
</head>


<body>

<div class="container">

 
        
  <div class="row mt-5">
    
    <div class="col-md-8">
     
      <h1> <b><?= $trx ?></b></h1>
    </div>
    <div class="col-md-4">
      <a href="<?= base_url('C_@file_name') ?>" class="btn btn-primary" >Kembali</a>
      <?php if ($this->session->userdata('user_name') == $nik->nik ) { ?>
        <button class="btn btn-success" onclick="$('#modal-confirm-approve').modal('show')" >Approve</button>
        <button class="btn btn-warning" onclick="$('#modal-reject').modal('show')">Reject</button>

      <?php } else { ?>
        <button class="btn btn-success" onclick="approve_data()" hidden>Approve</button>
        <button class="btn btn-warning" onclick="reject_data()" hidden>Reject</button>
      <?php } ?>


    </div>
  </div>

  <!-- modal-reject-approve -->
 

</div>

<!-- Modal -->
<div class="modal fade" id="modal-reject" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-danger">
            <div class="modal-header">
                <h4 class="modal-title">Reason reject</h4>
                <button type="button" class="close" onclick="$('#modal-reject').modal('hide')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Isi Modal -->
                <div class="form-group">
                    <label for="reason">REASON</label>
                    <textarea rows="2" type="text" name="reason" class="form-control" id="reason"></textarea>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-outline-light" onclick="$('#modal-reject').modal('hide')">Cancel</button>
                <button type="button" id="process_reject" onclick="reject_data()" class="btn btn-outline-light">Reject</button>
            </div>
        </div>
    </div>
</div>


 <!--  modal-confirm-approve -->
 <div class="modal fade" id="modal-confirm-approve">
        <div class="modal-dialog">
            <div class="modal-content bg-success">

            <div class="modal-header">
                <h4 class="modal-title">Approval confirmation</h4>
                <button type="button" class="close"onclick="$('#modal-confirm-approve').modal('hide')">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <label id="iddelete2" hidden> </label>Apakah ingin approve <label id="iddelete" hidden> </label> ?
                <br>
                <label id="lblposition" hidden> </label>
                <br>
                <label id="lbluserconfirm" hidden> <?php echo $userid; ?> </label>
                <label id="iduserlogin" hidden> <?php echo $hdrid; ?> </label>
            </div>

            <div class="modal-footer justify-content-between">

                <button type="button" onclick="approve_data()" class="btn btn-outline-light">Approve</button>
                <button type="button" class="btn btn-outline-light" onclick="$('#modal-confirm-approve').modal('hide')">Cancel</button>

            </div>

            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
        </div>

<script>
function approve_data()
{
   // Form data
   var fdata = new FormData();

    fdata.append('hdrid',"<?php echo $trx ?>");
    fdata.append('nik', "<?php echo $nik->nik; ?>");
    fdata.append('nik_admin', "<?php echo $tb_master->nik; ?>");
    fdata.append('position_code', "<?php echo $nik->position_code; ?>");

    // Url Post reject
    vurl = "<?php echo base_url('C_email/ajax_approve') ?>";

    // Post data
      $.ajax({
      url: vurl,
      method: "post",
      processData: false,
      contentType: false,
      data: fdata,

      success: function(data) {

          success_alert();
          $('#modal-confirm-approve').modal('hide');
      },
      error: function(e) {
      //Pesan Gagal
        gagal(e);

      }
    });
}

function reject_data() {

// Validasi reason harus diisi
  if ($('#reason').val() == '') 
  {
      gagal('Reason wajib diisi...');
      return false;
  }

  // Form data
  var fdata = new FormData();

  fdata.append('hdrid',"<?php echo $trx ?>");
  fdata.append('reason', $('#reason').val());
  fdata.append('nik_admin', "<?php echo $tb_master->nik; ?>");
  fdata.append('rejected_by', "<?= $nik->name; ?>");
  fdata.append('position_name', "<?= $nik->position_name; ?>");

  // Url Post reject
  vurl = "<?php echo base_url('C_email/ajax_reject') ?>";

  // Post data
  $.ajax({
  url: vurl,
  method: "post",
  processData: false,
  contentType: false,
  data: fdata,
  success: function(data) {

      // Hide modal delete
      success_alert_reject();
      $('#modal-reject').modal('hide');



  },
  error: function(e) {
      //Pesan Gagal
      gagal(e);
  }
  });
}


</script>
</body>
</html>